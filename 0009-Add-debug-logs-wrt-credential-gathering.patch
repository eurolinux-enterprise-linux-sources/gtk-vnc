From 109cb2369ce3064e96c91e4387c4e122cf722d53 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Daniel=20P=2E=20Berrang=C3=A9?= <berrange@redhat.com>
Date: Wed, 31 Jan 2018 11:11:09 +0000
Subject: [PATCH] Add debug logs wrt credential gathering
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Daniel P. Berrang√© <berrange@redhat.com>
(cherry picked from commit 8e14f8a00c486ac4a133fcd190526e73406d9cb6)
---
 src/vncconnection.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/vncconnection.c b/src/vncconnection.c
index e5496ef..35966c9 100644
--- a/src/vncconnection.c
+++ b/src/vncconnection.c
@@ -3537,6 +3537,8 @@ static gboolean vnc_connection_gather_credentials(VncConnection *conn)
 {
     VncConnectionPrivate *priv = conn->priv;
 
+    VNC_DEBUG("Checking if credentials are needed");
+
     if (priv->coroutine_stop)
         return FALSE;
 
@@ -3554,16 +3556,19 @@ static gboolean vnc_connection_gather_credentials(VncConnection *conn)
             g_value_init(&username, VNC_TYPE_CONNECTION_CREDENTIAL);
             g_value_set_enum(&username, VNC_CONNECTION_CREDENTIAL_USERNAME);
             authCred = g_value_array_append(authCred, &username);
+            VNC_DEBUG("Want a username");
         }
         if (priv->want_cred_password) {
             g_value_init(&password, VNC_TYPE_CONNECTION_CREDENTIAL);
             g_value_set_enum(&password, VNC_CONNECTION_CREDENTIAL_PASSWORD);
             authCred = g_value_array_append(authCred, &password);
+            VNC_DEBUG("Want a password");
         }
         if (priv->want_cred_x509) {
             g_value_init(&clientname, VNC_TYPE_CONNECTION_CREDENTIAL);
             g_value_set_enum(&clientname, VNC_CONNECTION_CREDENTIAL_CLIENTNAME);
             authCred = g_value_array_append(authCred, &clientname);
+            VNC_DEBUG("Want a TLS clientname");
         }
 
         sigdata.params.authCred = authCred;
@@ -3577,6 +3582,8 @@ static gboolean vnc_connection_gather_credentials(VncConnection *conn)
         VNC_DEBUG("Waiting for missing credentials");
         g_condition_wait(vnc_connection_has_credentials, conn);
         VNC_DEBUG("Got all credentials");
+    } else {
+        VNC_DEBUG("No credentials required");
     }
     return !vnc_connection_has_error(conn);
 }
